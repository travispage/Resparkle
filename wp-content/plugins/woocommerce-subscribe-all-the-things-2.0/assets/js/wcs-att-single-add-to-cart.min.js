!function(a){var b=function(b){var c=this;this.initialize_ui=function(){var a=b.$bundle_data.find(".wcsatt-options-wrapper");a.length>0&&(!1!==b.$addons_totals?b.$addons_totals.after(a):b.$bundle_price.after(a))},this.initialize_schemes=function(){b.satt_schemes=[];var c=b.$bundle_wrap.find(".wcsatt-options-product .subscription-option");a.each(c,function(c,d){var e=a(this),f=a(this).find("input").data("custom_data");b.satt_schemes.push({el:e,data:f,price_html_o:e.find(".subscription-price").html(),details_html:a("<div>").html(e.find(".subscription-details")).html()})})},this.integrate=function(){c.initialize_ui(),c.initialize_schemes(),b.$bundle_data.on("woocommerce-product-bundle-updated-totals",c.update_subscription_totals),b.$bundle_data.on("woocommerce-product-bundle-validation-status-changed",c.update_subscription_totals)},this.update_subscription_totals=function(b,d){d.satt_schemes.length>0&&a.each(d.satt_schemes,function(b,e){var f=d.get_price_html();if(1===d.satt_schemes.length&&0===d.$bundle_wrap.find(".wcsatt-options-product .one-time-option").length)d.$bundle_price.find(".price").html(a(f).html()+e.details_html);else{var g=e.el.find(".subscription-price");if(!0===e.data.overrides_price){var h=a.extend(!0,{},d.price_data);"inherit"===e.data.subscription_scheme.pricing_mode&&e.data.subscription_scheme.discount>0?(a.each(d.bundled_items,function(a,b){var c=b.bundled_item_id;e.data.discount_from_regular?h.prices[c]=h.regular_prices[c]*(1-e.data.subscription_scheme.discount/100):h.prices[c]=h.prices[c]*(1-e.data.subscription_scheme.discount/100),h.addons_prices[c]=h.addons_prices[c]*(1-e.data.subscription_scheme.discount/100)}),h.base_price=h.base_price*(1-e.data.subscription_scheme.discount/100)):"override"===e.data.subscription_scheme.pricing_mode&&(h.base_regular_price=Number(e.data.subscription_scheme.regular_price),h.base_price=Number(e.data.subscription_scheme.price)),h=d.calculate_subtotals(!1,h),h=d.calculate_totals(h),f=d.get_price_html(h)}d.passes_validation()?g.html(a(f).html()+e.details_html).find("span.total").remove():g.html(e.price_html_o),g.trigger("wcsatt-updated-bundle-price",[f,e,d,c])}})},this.integrate()},c=function(b){var c=this;this.initialize_ui=function(){var a=b.$composite_data.find(".wcsatt-options-wrapper");a.length>0&&(!1!==b.composite_price_view.$addons_totals?b.composite_price_view.$addons_totals.after(a):b.$composite_price.after(a))},this.initialize_schemes=function(){b.satt_schemes=[];var c=b.$composite_data.find(".wcsatt-options-product .subscription-option");a.each(c,function(c,d){var e=a(this),f=a(this).find("input").data("custom_data");b.satt_schemes.push({el:e,data:f,price_html_o:e.find(".subscription-price").html(),details_html:a("<div>").html(e.find(".subscription-details")).html()})})},this.integrate=function(){c.initialize_schemes(),b.actions.add_action("initialize_composite",function(){c.initialize_ui(),b.satt_schemes.length>0&&(b.satt_schemes.length>1||b.$composite_data.find(".composite_wrap .wcsatt-options-product .one-time-option").length>0?(b.actions.add_action("composite_totals_changed",c.update_subscription_totals,101,c),b.actions.add_action("composite_validation_status_changed",c.update_subscription_totals,101,c)):b.filters.add_filter("composite_price_html",c.filter_price_html,10,c))},51,this)},this.filter_price_html=function(c,d,e){var f=b.satt_schemes[0].details_html;return c=a(c).append(f).prop("outerHTML")},this.update_subscription_totals=function(){b.satt_schemes.length>0&&a.each(b.satt_schemes,function(d,e){var f=b.composite_price_view.get_price_html();if($scheme_price=e.el.find(".subscription-price"),!0===e.data.overrides_price){var g=a.extend(!0,{},b.data_model.price_data);"inherit"===e.data.subscription_scheme.pricing_mode&&e.data.subscription_scheme.discount>0?(a.each(b.get_components(),function(a,b){var c=b.component_id;e.data.discount_from_regular?g.prices[c]=g.regular_prices[c]*(1-e.data.subscription_scheme.discount/100):g.prices[c]=g.prices[c]*(1-e.data.subscription_scheme.discount/100),g.addons_prices[c]=g.addons_prices[c]*(1-e.data.subscription_scheme.discount/100)}),g.base_price=g.base_price*(1-e.data.subscription_scheme.discount/100)):"override"===e.data.subscription_scheme.pricing_mode&&(g.base_regular_price=Number(e.data.subscription_scheme.regular_price),g.base_price=Number(e.data.subscription_scheme.price)),g=b.data_model.calculate_subtotals(!1,g);var h=b.data_model.calculate_totals(g);g.totals=h,f=b.composite_price_view.get_price_html(g)}"pass"===b.api.get_composite_validation_status()?$scheme_price.html(a(f).html()+e.details_html).find("span.total").remove():$scheme_price.html(e.price_html_o),$scheme_price.trigger("wcsatt-updated-composite-price",[f,e,b,c])})},this.integrate()};a(".bundle_form .bundle_data").each(function(){a(this).on("woocommerce-product-bundle-initializing",function(a,c){c.is_composited()||new b(c)})}),a(".composite_form .composite_data").each(function(){a(this).on("wc-composite-initializing",function(a,b){new c(b)})})}(jQuery);